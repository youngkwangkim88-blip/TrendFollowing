# Strategy B 변형(BA/BB) — 설계 의도 및 구현 매핑
> 업데이트: 2026-02-12 (Asia/Seoul)

본 문서는 `entry_rules.md`의 Type B(회귀 기반) 진입 규칙을 실제 코드 열거형(`EntryRuleType`)과 1:1로 매핑하고,
**“005930에서 신호가 0회로 나오는 대표 원인(동시 조건 과도)”** 을 피하기 위한 권장 변형 2종을 정리한다.

---

## 1) 배경: 왜 기존 B_SLOPE20이 신호를 거의 못 내는가
기존 구현(`EntryRuleType.B_SLOPE20`)은 아래를 **같은 날(T)** 동시에 요구한다.

- `norm_slope_20`의 0선 돌파(변곡)
- `r2_20(T) > 0.6`
- `close(T)`와 `ma60(T)` 방향 필터

현실적으로 0선 돌파가 발생하는 “변곡일”은 추세가 막 형성/붕괴하는 구간이라 선형성이 낮아
`r2_20(T)`가 낮게 나오는 경향이 있다.  
이때 `r2_20 > 0.6`를 동시 요구하면 진입이 0회가 되는 케이스가 쉽게 발생한다.

---

## 2) Strategy BA (권장) — 레짐 진입
- **EntryRuleType:** `BA_REGIME20`
- **핵심:** “0선 돌파”를 직접 트리거로 사용하지 않는다.
- **대신:** (기울기 부호 + r² + MA60)으로 정의한 레짐이 **처음 True가 되는 날**에 진입한다.

장점:
- 신호가 과소 발생하는 문제 완화
- 추세가 “통계적으로 깔끔하게” 잡힌 구간 초입에서 진입

주의:
- 레짐 유지 기간이 길면 진입 빈도가 오히려 줄 수 있음(필요 시 r² threshold 완화 가능)

---

## 3) Strategy BB (권장) — 0선 돌파 + r² 전일 평가
- **EntryRuleType:** `BB_CROSS20_R2PREV`
- **핵심:** 0선 돌파는 유지하되, r²는 룩어헤드 없이 **전일(T-1)** 로 평가한다.

장점:
- 기존 “크로스 기반 진입” 감각 유지
- 변곡일 r² 붕괴 문제를 피함(lookahead 없음)

주의:
- r² 전일 조건은 “전일이 이미 선형 추세였는데, 당일 방향 전환이 난 경우”를 잡아낼 수 있어
  전략 성격이 약간 변한다(백테스트로 수용 여부 판단).

---

## 4) 코드 위치
- 구현: `src/invest_v2/strategy/entry_rules.py`
- 열거형: `src/invest_v2/core/types.py`

---

## 5) 빠른 검증 체크리스트
- [ ] 005930 단일 종목에서 BA/BB 각각 거래 횟수 > 0 확인
- [ ] 롱온리/롱숏 분리 성과 확인
- [ ] 거래 빈도 과다/과소 시 `r2_threshold`, `ma_window`를 옵션화할지 결정
